<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Script-Type" content="text/javascript">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="description" content="鮭男のホームページ">
        <meta name="keywords" contents="鮭男">
        <meta name="twitter:title" content="鮭男のホームページ">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://www.mass-site.work/img/card.png">
        <meta name="twitter:image:alt" content="shakeo">
        <meta name="twitter:description" content="作ったゲームとかブログとか載せてます。">
        <meta name="twitter:url" content="https://www.mass-site.work/index.html">
        <meta name="twitter:site" content="@manjyu0910">
        <meta name="twitter:domain" content="www.mass-site.work">
        <meta property="og:title" content="鮭男のホームページ">
        <meta property="og:url" content="https://www.mass-site.work/index.html">
        <meta property="og:site_name" content="鮭男のホームページ">
        <meta property="og:image" content="https://www.mass-site.work/img/card.png">
        <meta property="og:image:alt" content="shakeo"">
        <meta property="og:description" content="作ったゲームとかブログとか載せてます。">
        <meta property="og:locale" content="ja_JP">
        <title>Tips/鮭男のホームページ</title>
        <link rel="stylesheet" href="css/stylesheet.css">
        <link rel="icon" href="favicon.ico">
    </head>
    <body>
        <!-- header -->
        <script src="common_js/headermaker.js"></script>
        <script>header(0, 0)</script>
        <!-- <header>
            <img src="img/logo.png" alt="ロゴ" width="128" height="128">
            <div>
            <h1>鮭男のホームページ</h1>
            <nav>
                <ul>
                    <a href="index.html"><li class="selected">Tips</li></a>
                    <a href="about.html"><li>About</li></a>
                    <a href="blog.html"><li>Blog</li></a>
                    <a href="games.html"><li>Games</li></a>
                </ul>
            </nav>
            </div>
        </header> -->
        <hr>
        鮭男のホームページへようこそ

        <!-- tips -->
        <form action="commentformtest.html" method="post">
            名前：<br />
            <input type="text" name="name" size="30" value="" /><br />
            コメント：<br />
            <textarea name="comment" cols="30" rows="5"></textarea><br />
            <br />
            <input type="submit" name='btn_submit' value="登録する" />
        </form>
        <?php
            define( 'FILENAME', '/cgi-bin/message.txt');
            $now_date = null;
            $data = null;
            date_default_timezone_set('Asia/Tokyo');
            $now_date = date("Y-m-d H:i:s");

            $split_data = null;
            $message = array();
            $message_array = array();
            
            if(!empty($_POST['btn_submit'])){

                if(empty($_POST['name'])){
                    $error_message[] = '名前を入力してください。';	
                }
                if(empty($_POST['comment'])) {
                    $error_message[] = 'コメントを入力してください。';
                }
    
                if(empty($error_message)){
                    echo 'in';
                    if($fp = fopen(FILENAME, "a")){
                        $data = "'".$_POST['name']."','".$_POST['comment']."','".$now_date."'\n";
                        fputs($fp, $data);
                        fclose($fp);
                    }else{
                        echo 'fileopen a failed';
                    }
                }
    
                if($fp = fopen( FILENAME,'r')) {
                    while($data = fgets($fp)){
                        //echo $data . "<br>";
                        $split_data = preg_split( '/\'/', $data);
                        $message = array(
                            'view_name' => $split_data[1],
                            'message' => $split_data[3],
                            'post_date' => $split_data[5]
                        );
                        array_unshift( $message_array, $message);
                    }
                    fclose($fp);
                }else{
                    echo 'fileopen r failed';
                }
            }

        ?>
        <br>
        <?php if( !empty($error_message) ): ?>
            <ul class="error_message">
                <?php foreach( $error_message as $value ): ?>
                    <li><?php echo $value; ?></li>
                <?php endforeach; ?>
            </ul>
        <?php endif; ?>
        <?php if( !empty($message_array) ): ?>
        <?php foreach( $message_array as $value ): ?>
        <article>    
            <div class="info">        
                <h2><?php echo $value['view_name']; ?></h2>
                <time><?php echo date('Y年m月d日 H:i', strtotime($value['post_date'])); ?></time>
            </div>    
            <p><?php echo $value['message']; ?></p>
        </article>
        <?php endforeach; ?>
        <?php endif; ?>

        <!-- footer -->
        <footer>
            <hr>
            last update :
            <script type="text/javascript">
                document.write(document.lastModified);
            </script><br>
            © 2020 Shakeo
        </footer>
    </body>
</html>